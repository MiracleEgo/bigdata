# SSH运行过程 

* Client向Server发起SSH连接请求
* Server向Client发起版本协商
  * 服务器比较客户端发来的版本号,决定是否能同客户端工作,能则进入下一阶段,不能则断开链接
* 算法协商阶段
  * Client和Server向对方发送一个自己支持的公钥算法列表,加密算法列表,消息验证码算法列表,压缩算法列表,确定使用的算法
  * 然后使用DH交换算法,利用主机密钥对等参数,生成会话密钥和会话ID
* 认证阶段,从此以后所有通信均加密 
  * 用户密码
    * 客户端获取用户密码后使用服务器公钥进行加密并发给服务器,服务器用自己私钥解密
  * 公钥认证(免密码登陆)
    * 将客户端公钥手动复制到服务器的authorized_keys文件,相当于服务器获取了客户端公钥
    * Server用Client公钥加密一个256位随机字符串,客户端接收后使用私钥解密,将字符串和会话id合并,对其用MD5散列函数并把散列值返回给服务器,服务器进行相同散列处理,若客户端与该值匹配,则谁成功,允许登陆
* 交互阶段

# 中间人攻击 

* 如果首次连接没有中间人,则之后的连接不用担心中间人,因中间人与服务端公钥相同的可能性几乎可以忽略

# RSA算法原理

* 对称加密算法
  * 甲方必须把加密规则告诉给乙方，否则无法解密
  * 保存和传递密钥成为最大问题
* 非对称加密算法(RSA)
  * 非对称加密算法（DH算法）
  * 乙方生成公钥和私钥，公钥公开，私钥保密
  * 甲方获取乙方的公钥，然后用它信息加密
  * 乙方得到加密信息。用私钥解密