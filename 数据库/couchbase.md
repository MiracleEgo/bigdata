# CouchBase原理

* 由couchdb+membase组成的非关系型数据库
  * 既能像couchdb存储json文档，也可像membase高速存储键值对
* 特点
  * 速度快
    * 放在内存中的数据库，直接操作内存
  * 高可用
    * 自带集群方案，支持多副本模式
    * 自带持久化方案，可定时把数据异步写到文件系统上
  * 配置使用方便 
    * 自带web管理台，可在管理台上对集群，桶，索引，搜索等进行管理操作

* 索引
  * 全局二级索引(Global Secondary Index)
    * 用于庞大的网络节点,快速执行交互式处理
    * 相当于把索引信息放在一个节点,每次查询只用去查询该 节点
    * 网络节点较多时全局二级索引更快
  * 本地索引(Local Index)
    * 多用于本节点上复杂的逻辑和预处理程序,速度较快,但在集群有多节点的情况下速度会下降
    * 相当于索引信息放在每一个节点,当需要查询时,会在每个节点上获取该节点上的索引去查询,最后将结果汇总一起

# CouchBase与其他NoSql区别 

* Hbase

  * 优点
    * 存储容量大，一表可容纳上亿行，上百万列
    * 可通过版本检索，能搜到所需历史版本数据
    * 负载高，可通过添加机器实现水平切分扩展，跟Hadoop无缝集成保障其数据可靠性(HDFS)和海量数据分析的高性能(MapReduce)
    * 有效避免单点故障的发生
  * 适用场景
    * bigtable类型的数据存储
    * 对数据版本查询有需求
    * 应对超大数据量要求扩展简单的需求

* Redis

  * 优点 
    * 非富的数据结构
    * 提供事务功能，保证命令的原子性
    * 数据存在内存，读写高速

  * 适用场景
    * 数据变化快且数据库大小可遇见

* MongoDB

  * 优点
    * 自动化shading功能 
    * 全索引支持，查询非常高效
    * 面向文档存储，数据模式简单而强大
    * 支持动态查询 ，可轻易查询文档中内嵌的对象及数组
    * 支持javascript表达式查询，可在服务器端执行任意javascript函数
  * 缺点 
    * 单文档大小限制16M，不支持大于2.5G的数据
    * 对内存要求较大
    * 非事务，无法保证原子性
  * 适用场景 
    * 适用于实时插入，更新与查询需求，具备实时数据存储所需的复制及高度伸缩性
    * 适合文档化格式的存储及查询
    * 适合数十或数百台服务器组成的数据库

* Couchbase
  * 优点 
    * 高并发，高灵活性，高拓展性，容错性好
    * 以vBucket的概念实现更理想化的自动分片及动态扩容
  * 缺点
    * 存储方式为Key/Value，但Value的类型单一 ，不支持数组 
    * 不会自动创建doc id，需为每一文档指定一个用于存储的Document Indentifer
    * 各种组件拼接而成，都是C++实现，导致复杂度过高
    * 缓存全部key,需大量内存，节点宕机时failover过程有不可用时间 ，并且有部分数据丢失的可能 ，在高负载系统上有假死现象
  * 适用场景
    * 适合对读写速度要求高，但服务器负荷和内存花销可遇见的需求
    * 需要支持memcached协议的需求